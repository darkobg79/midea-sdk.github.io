<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> MideaSDK-iOS 3.0 快速集成说明 · Midea Smart Technology Co.,Ltd.</title><meta name="description" content="MideaSDK-iOS 3.0 快速集成说明 - Midea Smart Technology Co.,Ltd."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="../../../../favicon.jpeg"><link rel="stylesheet" href="../../../../css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="Midea Smart Technology Co.,Ltd."></head><body><div class="wrap"><header><a href="../../../../index.html" class="logo-link"><img src="../../../../favicon.jpeg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="../../../../index.html" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="../../../../archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="../../../../api/" target="_self" class="nav-list-link">快速集成</a></li><li class="nav-list-item"><a href="../../../../about/" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="http://iot.midea.com/" target="_blank" class="nav-list-link">开放平台</a></li><li class="nav-list-item"><a href="https://github.com/midea-sdk-org" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">MideaSDK-iOS 3.0 快速集成说明</h1><div class="post-info">2017年12月20日</div><div class="post-content"><p><img src="http://msmart.midea.com/images/brand.png" alt="美的智慧家居科技有限公司"> </p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Midea SDK是美的智慧家居系统控制端接入的一套iOS系统开发工具包，第三方开发者可以使用这套工具包提供的接口接入到美的智慧家居系统中实现本地或者远程控制美的家电。  </p>
<p>SDK适用的场景包括：手机、机电盒、智能电视、智能硬件设备等。</p>
<a id="more"></a>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p>SDK主要提供的功能包括：   </p>
<ol>
<li>账号注册登陆。     </li>
<li>设备配网和云端绑定。</li>
<li>局域网设备扫描。</li>
<li>设备控制命令本地/远程下发。    </li>
<li>服务器业务请求封装。    </li>
<li>设备协议可视化解析。    </li>
</ol>
<h2 id="业务介绍"><a href="#业务介绍" class="headerlink" title="业务介绍"></a>业务介绍</h2><p>SDK分为家庭业务模型和单用户业务模型。<br> 1.单用户模型：家电设备直接与用户进行绑定，单个设备在用户之间进行分享。<br> 2.家庭模型：家电和家庭进行关联，无法实现单个设备分享，用户通过加入家庭进行家庭中所有设备的全部共享。</p>
<blockquote>
<p>推荐使用单用户模型，因为数据模型耦合度低，扩展性好。但是如果需要和美居进行数据互通，则需要使用家庭租模型。</p>
</blockquote>
<h2 id="SDK使用前准备"><a href="#SDK使用前准备" class="headerlink" title="SDK使用前准备"></a>SDK使用前准备</h2><ol>
<li>注册美的智慧家居开发者账号。</li>
<li>可上网2.4G路由器一台。</li>
<li>美的智能家电一台。</li>
<li>MideaSDK开发包。</li>
<li>申请AppID,AppKey,AppSrc三个参数。</li>
<li>SDK提供的API文档。</li>
<li>智能手机一台（iOS 7.0及以上）。  </li>
</ol>
<blockquote>
<p>目前美的智能家电仅支持2.4G网络。一般家电上有MSmart标识的家电为智能家电，如果不确定可以咨询售后进行确认。智能手机也可以是任何可连接网络的iOS平台硬件终端。  </p>
</blockquote>
<p> <strong>登录美的智慧家居开发者官网申请AppID,AppKey,AppSrc：</strong><a href="https://iot.midea.com/develop" target="_blank" rel="external">开发者官网</a></p>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><ol>
<li>注册开发者。</li>
<li>体检开发申请。   </li>
<li>获取AppID等参数。</li>
<li>下载SDK。</li>
<li>集成配网SDK。  </li>
<li>开发审核发布。</li>
</ol>
<h2 id="MideaSDK接入文档"><a href="#MideaSDK接入文档" class="headerlink" title="MideaSDK接入文档"></a>MideaSDK接入文档</h2><p><a href="https://github.com/midea-sdk-org/ios-sdk/blob/master/README.md" target="_blank" rel="external">英文文档</a></p>
<h4 id="1-集成MideaSDK到你的项目中："><a href="#1-集成MideaSDK到你的项目中：" class="headerlink" title="1. 集成MideaSDK到你的项目中："></a>1. 集成MideaSDK到你的项目中：</h4><h5 id="1-1-手动集成MideaSDK到你的项目中："><a href="#1-1-手动集成MideaSDK到你的项目中：" class="headerlink" title="1.1 手动集成MideaSDK到你的项目中："></a>1.1 手动集成MideaSDK到你的项目中：</h5><p>1.1.1 根据需要导入<code>MSmartSDK.framework</code>至工程，如图</p>
<p><img src="https://github.com/midea-sdk-org/ios-sdk/raw/master/pic/p1.jpg" alt=""> </p>
<p>1.1.2 引入所需的系统库，如图</p>
<p><img src="https://github.com/midea-sdk-org/ios-sdk/raw/master/pic/%E5%AF%BC%E5%85%A5%E7%B3%BB%E7%BB%9F%E5%BA%93.jpeg" alt=""> </p>
<p><strong><em>备注：标识1（<code>MSmartSDK.framework</code>）必须放置在2（<code>libsqlite3.tbd</code>）上面</em></strong></p>
<p>1.1.3 进入工程<code>TARGETS--&gt;Build Settings</code> 设置<code>Other Linker Flags</code>为<code>-all_load</code> 或者<code>-ObjC</code> 或者 <code>–fore_load</code> (sdk路径)，如图</p>
<p><img src="https://github.com/midea-sdk-org/ios-sdk/raw/master/pic/p3.jpg" alt=""> </p>
<p><strong>1.2 Cocoapods management</strong></p>
<p>MideaSDK 已经支持 <a href="http://cocoapods.org/" target="_blank" rel="external">CocoaPods</a>。使用 <a href="http://cocoapods.org/" target="_blank" rel="external">CocoaPods</a> 可以方便的使用 MideaSDK，在你工程的Podfile添加：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod <span class="string">'MSmartSDK'</span></div></pre></td></tr></table></figure>
<h4 id="2-在项目的-info-plist-中配置-“App-Transport-Security（ATS）”-："><a href="#2-在项目的-info-plist-中配置-“App-Transport-Security（ATS）”-：" class="headerlink" title="2. 在项目的 info.plist 中配置 “App Transport Security（ATS）” ："></a>2. 在项目的 <code>info.plist</code> 中配置 “App Transport Security（ATS）” ：</h4><p><img src="https://github.com/midea-sdk-org/ios-sdk/raw/master/pic/ATS%E8%AE%BE%E7%BD%AE.jpeg" alt=""> </p>
<h4 id="3-在需要使用SDK的对象中导入相应文件"><a href="#3-在需要使用SDK的对象中导入相应文件" class="headerlink" title="3. 在需要使用SDK的对象中导入相应文件"></a>3. 在需要使用SDK的对象中导入相应文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#import &lt;MSmartSDK/MSmartSDK.h&gt;</div></pre></td></tr></table></figure>
<h4 id="4-调用接口初始化SDK（无论使用哪些功能，都需保证第一个调用此接口完成初始化）"><a href="#4-调用接口初始化SDK（无论使用哪些功能，都需保证第一个调用此接口完成初始化）" class="headerlink" title="4. 调用接口初始化SDK（无论使用哪些功能，都需保证第一个调用此接口完成初始化）"></a>4. 调用接口初始化SDK（无论使用哪些功能，都需保证第一个调用此接口完成初始化）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">/*!</div><div class="line"> * The initial API of MideaSDK must be the first called one if you intend to use the MideaSDK.</div><div class="line"> *</div><div class="line"> *</div><div class="line"> * @param appID   - AppID,AppKey and AppSrc are assigned by Midea.</div><div class="line"> * @param appKey  - </div><div class="line"> * @param appSrc  - </div><div class="line"> * @param mode    - the running mode of SDK</div><div class="line"> *</div><div class="line"> * @param completion - Async ACK(block)</div><div class="line"> * &quot;error&quot; is the the result of this API. </div><div class="line"> * &quot;error.code&quot; contain:</div><div class="line"> * 0     Succeed</div><div class="line"> * &gt;0    Failed. Detailed info is defined in &quot;MSmartErrorCode&quot; or &quot;error.localizedDescription&quot;</div><div class="line"> *</div><div class="line"> **/</div><div class="line">- (void)initSDKWithAppID:(NSString*)appID</div><div class="line">                  appKey:(NSString*)appKey</div><div class="line">                  appSrc:(NSInteger)appSrc</div><div class="line">                workMode:(MSmartWorkMode)mode</div><div class="line">              completion:(void (^)(NSError* error))completion;</div></pre></td></tr></table></figure>
<p>其中<code>workMode</code>参数选择使用的工作模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM (NSInteger, MSmartWorkMode)</div><div class="line">&#123;</div><div class="line">    MSmartWorkModeFamily = 0,//家庭组</div><div class="line">    MSmartWorkModeFriend = 1,//单用户</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[[MSmartSystemManager sharedManager] initSDKWithAppID:AppID</div><div class="line">                        appKey:AppKey</div><div class="line">                        appSrc:AppSrc</div><div class="line">                       workMode:MSmartWorkModeFamily</div><div class="line">                    completion:^(NSError *error) &#123;</div><div class="line">                       [MSTools printError:error];</div><div class="line">                    &#125;];</div></pre></td></tr></table></figure>
<h4 id="5、选择环境：正式环境-测试环境："><a href="#5、选择环境：正式环境-测试环境：" class="headerlink" title="5、选择环境：正式环境/测试环境："></a>5、选择环境：正式环境/测试环境：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> *  修改服务器接口</div><div class="line"> *</div><div class="line"> *  @param serverAddress 服务器类型</div><div class="line"> *</div><div class="line"> *  @return 是否成功</div><div class="line"> */</div><div class="line">- (BOOL)setupServerAddress:(MSmartServer)serverAddress;</div></pre></td></tr></table></figure>
<p>枚举值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM (NSInteger, MSmartServer) &#123;</div><div class="line">    MSmartServerDevelopment        = 0,//测试服</div><div class="line">    MSmartServerProduction         = 1,//正式服</div><div class="line">    MSmartServerOverseaDevelopment = 2,//海外版测试服</div><div class="line">    MSmartServerOverseaProduction  = 3//海外版正式服</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[MSmartSystemManager sharedManager] setupServerAddress:MSmartServerProduction];</div></pre></td></tr></table></figure>
<h4 id="6、设置http-https（必选）："><a href="#6、设置http-https（必选）：" class="headerlink" title="6、设置http/https（必选）："></a>6、设置http/https（必选）：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> *  开启https通道，默认关闭</div><div class="line"> *</div><div class="line"> *  @param open - 打开或关闭</div><div class="line"> */</div><div class="line">- (void)openHttpsChanel:(BOOL)open;</div></pre></td></tr></table></figure>
<h2 id="核心业务介绍"><a href="#核心业务介绍" class="headerlink" title="核心业务介绍"></a>核心业务介绍</h2><h3 id="1-注册"><a href="#1-注册" class="headerlink" title="1. 注册"></a>1. 注册</h3><h4 id="1-1-手机号注册"><a href="#1-1-手机号注册" class="headerlink" title="1.1. 手机号注册"></a>1.1. 手机号注册</h4><p>​    通过手机号和验证码注册到MCloud</p>
<p>获取手机验证码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Get verify code with cell phone number.</div><div class="line"></div><div class="line"> @since (mainland)  (group/single user)</div><div class="line"> @param phoneNum cell phone number</div><div class="line"> @param verifyType authenticate type,detailed definition in MSmartGetVerifyType</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)getVerifyCodeWithPhoneNum:(NSString *)phoneNum</div><div class="line">                           andType:(MSmartGetVerifyType)verifyType</div><div class="line">                        completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<p>注册</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Register an account with cell phone number.</div><div class="line"></div><div class="line"> @since (mainland)  (group/single user)</div><div class="line"> @note call getVerifyCodeWithPhoneNum first.</div><div class="line"> @param phoneNum user cell phone</div><div class="line"> @param password user password</div><div class="line"> @param verifyCode verifyCode</div><div class="line"> @param nickName user nickname</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void) registerWithPhoneNum:(NSString *)phoneNum</div><div class="line">                     password:(NSString *)password</div><div class="line">                   verifyCode:(NSString *)verifyCode</div><div class="line">                     nickName:(NSString *)nickName</div><div class="line">                   completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<h4 id="1-2-邮箱注册"><a href="#1-2-邮箱注册" class="headerlink" title="1.2 邮箱注册"></a>1.2 邮箱注册</h4><p>​    通过邮箱账号注册到MCloud</p>
<p>​    海外环境可选择是否需要发送激活邮件，<code>extraDic</code>中key <code>kMSServerKeyNeedActive</code> 值为<code>kMSServerValueActiveTrue</code>表示需要发送邮件激活，值为<code>kMSServerValueActiveFalse</code>表示不需要发送邮件激活；</p>
<p>国内环境均为默认发送激活邮件；</p>
<p>​    目前海外环境以及国内环境登录时并未判断用户是否完成激活，即激活状态并不影响登录的成功与否。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Register an account with email.</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @param email user email</div><div class="line"> @param password user password</div><div class="line"> @param nickName user nickname</div><div class="line"> @param extraDic extra parameter dictionary,(Please refer to MSmartDefinition.h for detailed Dictionry key.)</div><div class="line"> </div><div class="line">  - kMSServerKeyNeedActive：need active flag(only for overseas)</div><div class="line"> </div><div class="line">    - kMSServerValueActiveTrue:need active；</div><div class="line">    - kMSServerValueActiveFalse:need not active,</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void) registerWithEmail:(NSString *)email</div><div class="line">                  password:(NSString *)password</div><div class="line">                  nickName:(NSString *)nickName</div><div class="line">                  extraDic:(NSDictionary *)extraDic</div><div class="line">                completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<h3 id="2-登录"><a href="#2-登录" class="headerlink" title="2.登录"></a>2.登录</h3><h4 id="2-1-通过注册的账号（手机号-邮箱）登录"><a href="#2-1-通过注册的账号（手机号-邮箱）登录" class="headerlink" title="2.1 通过注册的账号（手机号/邮箱）登录"></a>2.1 通过注册的账号（手机号/邮箱）登录</h4><p>​    若要使用推送功能，需在登录接口上传pushToken，<code>extraDic</code>参数中key <code>kMSServerKeyPushToken</code>传入pushToken的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Login with M-cloud account. You can only login the SDK after the SDK initialization.</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @param account user account(email or phone）</div><div class="line"> @param password user password (6-12)</div><div class="line"> @param extraDic extra parameter dictionary (Please refer to MSmartDefinition.h for detailed Dictionry key.)</div><div class="line"> </div><div class="line">  - kMSServerKeyPushToken    ：push token</div><div class="line">  - kMSServerKeyAppVNum      ：app version</div><div class="line">  - kMSServerKeyPhoneModel   ：cell phone model</div><div class="line">  - kMSServerKeySystemVersion：system version of cell phone</div><div class="line"> </div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">  - dict：user information（if error.code &gt; 0 dict = nil),please refer to MSmartDefinition.h for detailed Dictionry key.</div><div class="line"> </div><div class="line">    - kMSServerKeyVersionCode:the support of app minimum version</div><div class="line"> </div><div class="line">  - familysOrUsers：family list in family mode；user list in friend mode</div><div class="line">  - devices：appliance list</div><div class="line"> */</div><div class="line">- (void)loginWithAccount:(NSString *)account</div><div class="line">                 password:(NSString *)password</div><div class="line">                 extraDic:(NSDictionary *)extraDic</div><div class="line">               completion:(void (^)(NSError *error, NSDictionary *dict, NSArray *familysOrUsers, NSArray *devices))completion;</div></pre></td></tr></table></figure>
<h3 id="2-2-第三方登录"><a href="#2-2-第三方登录" class="headerlink" title="2.2 第三方登录"></a>2.2 第三方登录</h3><p>​    目前支持QQ和微信登录，其中<code>accessToken</code>和<code>thirdUid</code>分别为第三方的授权访问token和第三方来源Id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Login with third platform token (for QQ , WeChat)</div><div class="line"></div><div class="line"> @since (mainland)  (group/single user)</div><div class="line"> @param accessToken access token</div><div class="line"> @param thirdUid third ID</div><div class="line"> @param nickName user nickname</div><div class="line"> @param pushToken push token</div><div class="line"> @param srcPlatform platform type，detailed definition in MSmartThirdPlatform</div><div class="line"> @param paramters extra parameter dictionary</div><div class="line"> </div><div class="line">  - kMSServerKeyAppVNum</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">  - userInfo:user information</div><div class="line">  - familysOrUsers:</div><div class="line"> </div><div class="line">    - family list in family mode；</div><div class="line">    - user list in friend mode</div><div class="line">  - devices：appliance list</div><div class="line"> */</div><div class="line">- (void)userThirdLoginWithAccessToken:(NSString *)accessToken</div><div class="line">                             thirdUid:(NSString *)thirdUid</div><div class="line">                             nickName:(NSString *)nickName</div><div class="line">                            pushToken:(NSString *)pushToken</div><div class="line">                          srcPlatform:(MSmartThirdPlatform)srcPlatform</div><div class="line">                            paramters:(NSDictionary *)paramters</div><div class="line">                           completion:(void (^)(NSError *error,NSDictionary *userInfo, NSArray *familysOrUsers, NSArray *devices))completion;</div></pre></td></tr></table></figure>
<h3 id="3-配网"><a href="#3-配网" class="headerlink" title="3. 配网"></a>3. 配网</h3><h4 id="3-1-AP配网"><a href="#3-1-AP配网" class="headerlink" title="3.1 AP配网"></a>3.1 AP配网</h4><h5 id="（1）连接家电AP-家电设备处于AP模式，手机和家电设备AP直连，建立连接，如图，调用接口"><a href="#（1）连接家电AP-家电设备处于AP模式，手机和家电设备AP直连，建立连接，如图，调用接口" class="headerlink" title="（1）连接家电AP:家电设备处于AP模式，手机和家电设备AP直连，建立连接，如图，调用接口"></a>（1）连接家电AP:家电设备处于AP模式，手机和家电设备AP直连，建立连接，如图，调用接口</h5><p><img src="https://github.com/midea-sdk-org/ios-sdk/blob/master/pic/AP.png?raw=true" alt=""> </p>
<p><em>备注：设备AP SSID前缀形如<code>midea_XX_XXXX</code>。</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> step 2.1.1 connect to an appliance with MSmartConfigType equal to MSmartConfigAP or MSmartConfigJD. You can find the MSmartConfigType in th callback of API &apos;- (void)getConfigureTypeByQrcode:(NSString *)qrcode</div><div class="line"> completion:(void (^)(NSError *error,MSmartConfigType configType))completion&apos;.</div><div class="line">	</div><div class="line"> **Note:** use tips:</div><div class="line"> </div><div class="line">  1. new appliance will be in AP(access point) mode.</div><div class="line">  2. user need to connect to the appliance AP in the system setting manual if they are using iOS.</div><div class="line">	</div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @param ssid the SSID of appliance AP</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">*/</div><div class="line">- (void)connectDeviceWithSSID:(NSString*)ssid</div><div class="line">                    completion:(void (^)(NSError* error))completion;</div></pre></td></tr></table></figure>
<p><em>备注：调用此接口时手机必须和设备AP直连，即手机当前连接的wifi名称应该和<code>ssid</code>一致</em></p>
<h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">NSString *deviceSSID = @&quot;midea_10_0287&quot;;</div><div class="line">[[MSmartDeviceManager sharedManager] connectDeviceWithSSID:deviceSSID completion:^(NSError *error) &#123;</div><div class="line">if (error.code == ERROR_SUCCESS) &#123;</div><div class="line">    //连接成功</div><div class="line">    [self printStr:[NSString stringWithFormat:@&quot;连接热点成功&quot;]];</div><div class="line">    </div><div class="line">&#125; else &#123;</div><div class="line">    [self printStr:[NSString stringWithFormat:@&quot;配网失败，error：%@&quot;,error]];</div><div class="line">&#125;o</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h5 id="（2）绑定家电到指定wifi网络。前提：完成AP配网第一步，收到成功回调"><a href="#（2）绑定家电到指定wifi网络。前提：完成AP配网第一步，收到成功回调" class="headerlink" title="（2）绑定家电到指定wifi网络。前提：完成AP配网第一步，收到成功回调"></a>（2）绑定家电到指定wifi网络。前提：完成AP配网第一步，收到成功回调</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> step 2.2.1 If the MSmartConfigType equal to MSmartConfigAP, you can use this API to make the appliance connect to a specific network.</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @note there is a 90 seconds timeout. tip:wifi module is appliance can not support 5G wifi network.</div><div class="line"> @param homeSSID SSID of the wifi router</div><div class="line"> @param password password of the wifi router</div><div class="line"> @param bssid BSSID of the wifi router：31:63:6B:D9:2F:45，it can be 00:00:00:00:00:00 if you can&apos;t get the BSSID.</div><div class="line"> @param deviceName the name of the device, can be nil@&quot;&quot;</div><div class="line"> @param tsn can be nil or empty</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">  - dict：the information of the appliance.If the &quot;isActivity&quot; is 1 , that means the appliace is already activated.</div><div class="line"> */</div><div class="line">- (void)bindDeviceWithWifi:(NSString *)homeSSID</div><div class="line">                  password:(NSString *)password</div><div class="line">                 WiFiBSsid:(NSString *)bssid</div><div class="line">                deviceName:(NSString *)deviceName</div><div class="line">                       tsn:(NSString *)tsn</div><div class="line">                completion:(void (^)(NSError *error, NSDictionary *dict))completion;</div></pre></td></tr></table></figure>
<h5 id="（3）激活家电。前提：完成AP配网第二步，收到成功回调"><a href="#（3）激活家电。前提：完成AP配网第二步，收到成功回调" class="headerlink" title="（3）激活家电。前提：完成AP配网第二步，收到成功回调"></a>（3）激活家电。前提：完成AP配网第二步，收到成功回调</h5><p>​    激活家电是指在云端激活设备的远程控制权限，未激活的设备无法实现远程控制；家庭组和单用户激活家电的方式有所区别，家庭组是建立设备和家庭之间的绑定关系，单用户是建立设备和单个用户的绑定关系。</p>
<h6 id="家庭组"><a href="#家庭组" class="headerlink" title="家庭组"></a>家庭组</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">//MSmartDeviceManager.h</div><div class="line">/**</div><div class="line"> 激活家电，激活指激活家电的远程控制.通过SN激活（与[MSmartDeviceManager decryptSNWithQRCode:completion:]配套使用）</div><div class="line"> </div><div class="line"> @since (mainland)  (group)</div><div class="line"> @param deviceSN 设备SN（明文）</div><div class="line"> @param familyId 设备要绑定的家庭的familyId</div><div class="line"> @param extraDic extraDic举例如下，一般从[MSmartDeviceManager decryptSNWithQRCode:completion:]获取</div><div class="line"> </div><div class="line">  - deviceName = &quot;\U51b0\U7bb13306&quot;;</div><div class="line">  - deviceSsid = &quot;Midea_CA_3306&quot;;</div><div class="line">  - deviceSubType = 2;</div><div class="line">  - deviceType = CA;</div><div class="line">  - expired = 600;</div><div class="line">  - verificationCode = zIlcestl;</div><div class="line">  - verificationCodeKey = 17e4c7000eb8469b;</div><div class="line"> </div><div class="line"> @param completion 异步执行返回(block)</div><div class="line"> </div><div class="line">  - error：error.code值为0表示执行成功；大于0表示执行失败；具体错误提示见 MSmartErrorCode 定义或error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)activeDeviceWithDeviceSN:(NSString *)deviceSN</div><div class="line">                        familyId:(NSString *)familyId</div><div class="line">                        extraDic:(NSDictionary *)extraDic</div><div class="line">                      completion:(void (^)(NSError *error, NSDictionary *dictionary))completion;</div></pre></td></tr></table></figure>
<p><em>备注：只有家庭的家长才有权限向家庭绑定设备，因此当前的登录用户必须是<code>familyId</code>代表的家庭的家长该操作才能成功。</em></p>
<h6 id="单用户"><a href="#单用户" class="headerlink" title="单用户"></a>单用户</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//MSmartDeviceManager.h</div><div class="line">/**</div><div class="line"> Bind appliance with user</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (single user)</div><div class="line"> @param deviceSN appliance SN</div><div class="line"> @param tsn tsn from qrcode,it can be nil</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)bindDeviceWithDeviceSN:(NSString *)deviceSN</div><div class="line">                        andTsn:(NSString *)tsn</div><div class="line">                    completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<p><em>备注：此接口建立起设备与当前登录用户之间的绑定关系，并在云端激活设备的远程控制权限。</em></p>
<p>示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">//家庭组模式示例</div><div class="line">NSString *wifiSSID = @&quot;APP_TEST&quot;;</div><div class="line">NSString *pwdStr = @&quot;88888888&quot;;</div><div class="line">NSString *deviceName = @&quot;客厅插座&quot;;</div><div class="line">// 绑定设备至家庭WIFI:</div><div class="line">[self.deviceMgr bindDeviceWithWifi:wifiSSID</div><div class="line">                                  password:pwdStr</div><div class="line">                                 WiFiBSsid:@&quot;00:00:00:00:00:00&quot;</div><div class="line">                                deviceName:deviceName</div><div class="line">                                       tsn:nil</div><div class="line">                                completion:^(NSError *error, NSDictionary *dict) &#123;</div><div class="line">        if (error.code == ERROR_SUCCESS) &#123;</div><div class="line">            // 配网成功</div><div class="line">            if(![dict[@&quot;isActivity&quot;] isEqualToString:@&quot;1&quot;]) &#123;//设备未在云端完成绑定，继续完成绑定</div><div class="line">            //家庭组模式：绑定设备到家庭</div><div class="line">            [self.deviceMgr activeDeviceWithDeviceSN:dict[@&quot;deviceSn&quot;]</div><div class="line">                                            familyId:familyId</div><div class="line">                                            extraDic:nil</div><div class="line">                                          completion:^(NSError *error, NSDictionary *dictionary) &#123;</div><div class="line">                if(error.code == ERROR_SUCCESS) &#123;</div><div class="line">                    [self printStr:[NSString stringWithFormat:@&quot;配网成功，dic is %@&quot;,dict]];</div><div class="line">                &#125; else &#123;</div><div class="line">                    [self printStr:[NSString stringWithFormat:@&quot;配网失败，error is %@&quot;,error]];</div><div class="line">                &#125;</div><div class="line">            &#125;];</div><div class="line">            &#125; else &#123;</div><div class="line">                [self printStr:[NSString stringWithFormat:@&quot;配网成功,dict is %@&quot;,dict]];</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            if (error.code == ERROR_NETWORK_NOT_CHANGE) &#123;//当前手机未自动切换到所选择的wifi</div><div class="line">                self.iHud.labelText = @&quot;请将手机连接至选择的网络再返回本界面&quot;;</div><div class="line">            &#125; else &#123;// 配网失败</div><div class="line">                [self printStr:[NSString stringWithFormat:@&quot;配网失败，error is %@&quot;,error]];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//单用户模式示例</div><div class="line">[self.deviceMgr bindDeviceWithWifi:wifiSSID password:pwdStr WiFiBSsid:@&quot;00:00:00:00:00:00&quot; deviceName:deviceName tsn:nil completion:^(NSError *error, NSDictionary *dict) &#123;</div><div class="line">      if (error.code == ERROR_SUCCESS) &#123;</div><div class="line">          if(![dict[@&quot;isActivity&quot;] isEqualToString:@&quot;1&quot;]) &#123;//设备未在云端完成绑定，继续完成绑定</div><div class="line">              //单用户模式：绑定设备到用户</div><div class="line">              [self.deviceMgr bindDeviceWithDeviceSN:dict[@&quot;deviceSn&quot;] andTsn:nil 	 completion:^(NSError *error) &#123;</div><div class="line">                if(error.code == ERROR_SUCCESS) &#123;</div><div class="line">                    [self printStr:[NSString stringWithFormat:@&quot;配网成功，dic is %@&quot;,dict]];</div><div class="line">                &#125; else &#123;</div><div class="line">                    [self printStr:[NSString stringWithFormat:@&quot;配网失败，error is %@&quot;,error]];</div><div class="line">                &#125;</div><div class="line">              &#125;];</div><div class="line"></div><div class="line">          &#125; else &#123;</div><div class="line">              [self printStr:[NSString stringWithFormat:@&quot;配网成功,dict is %@&quot;,dict]];</div><div class="line">          &#125;</div><div class="line"></div><div class="line">      &#125; else &#123;</div><div class="line">          if (error.code == ERROR_NETWORK_NOT_CHANGE) &#123;//当前手机未自动切换到所选择的wifi</div><div class="line">              self.iHud.labelText = @&quot;请将手机连接至选择的网络再返回本界面&quot;;</div><div class="line">          &#125; else &#123;// 配网失败</div><div class="line">              [self printStr:[NSString stringWithFormat:@&quot;配网失败，error is %@&quot;,error]];</div><div class="line">          &#125;</div><div class="line">      &#125;</div><div class="line"> &#125;];</div></pre></td></tr></table></figure>
<h4 id="3-2-一机一码快连配网"><a href="#3-2-一机一码快连配网" class="headerlink" title="3.2 一机一码快连配网"></a>3.2 一机一码快连配网</h4><p>说明：一机一码是指一个家电设备有一个唯一标识的二维码，能够明确知道待配网的家电设备的<code>deviceSSID</code>是什么，比如<code>midea_10_0078</code></p>
<h5 id="（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和homeSSID一致"><a href="#（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和homeSSID一致" class="headerlink" title="（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和homeSSID一致"></a>（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和<code>homeSSID</code>一致</h5><p><img src="https://github.com/midea-sdk-org/ios-sdk/blob/master/pic/wifi.jpg?raw=true" alt=""> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> step 2.3.1 This API can be called if the MSmartConfigType of step 1 is MSmartConfigMSC. Once this api is called, it will not stop until get a calback or manually stop it.</div><div class="line"></div><div class="line"> **Note:** use tips:</div><div class="line"> </div><div class="line">  1. new appliance will be in SmartConfig mode.</div><div class="line">  2. app will connect wifi router</div><div class="line"> </div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @param deviceSSID appliance SSID</div><div class="line"> @param homeSSID SSID of wifi router</div><div class="line"> @param password password of wifi router</div><div class="line"> @param tsn sn from the qrcode, can be nil or empty</div><div class="line"> @param key reserve, can be nil</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">  - dict:appliance info</div><div class="line"> </div><div class="line">    - @&quot;deviceSn&quot;:sn,                 //sn</div><div class="line">    - @&quot;deviceSsid&quot;:ssid,             //ssid</div><div class="line">    - @&quot;deviceType&quot;:typeStr,          //appliance type</div><div class="line">    - @&quot;identifyTime&quot;:identifyTime,   //identify time(minutes)</div><div class="line">    - @&quot;identifyType&quot;:identifyType    //identify mode，0--device identify，1--SDK</div><div class="line"> */</div><div class="line">- (void)startSendMSCWithDeviceSSID:(NSString *)deviceSSID</div><div class="line">                          homeSSID:(NSString *)homeSSID</div><div class="line">                          password:(NSString *)password</div><div class="line">                               tsn:(NSString *)tsn</div><div class="line">                               key:(NSString *)key</div><div class="line">                        completion:(void (^)(NSError *error, NSDictionary *dict))completion;</div></pre></td></tr></table></figure>
<h5 id="（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。"><a href="#（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。" class="headerlink" title="（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。"></a>（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。</h5><h5 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">NSString *homeSSID = @&quot;APP_TEST&quot;;</div><div class="line">NSString *pwd = @&quot;88888888&quot;;</div><div class="line">NSString *deviceSSID = @&quot;midea_10_0078&quot;;</div><div class="line">NSString *tsn= @&quot;&quot;;</div><div class="line">[[MSmartDeviceManager sharedManager] startSendMSCWithDeviceSSID:deviceSSID homeSSID:homeSSID password:pwd tsn:tsn key:nil completion:^(NSError *error, NSDictionary *dict) &#123;</div><div class="line">    if(error.code == ERROR_SUCCESS) &#123;</div><div class="line">        //激活家电，参见AP配网激活家电步骤</div><div class="line">    &#125; else &#123;</div><div class="line">        [self printStr:[NSString stringWithFormat:@&quot;配网失败，error：%@&quot;,error]];</div><div class="line">    &#125;</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h4 id="3-3-一型一码快连配网"><a href="#3-3-一型一码快连配网" class="headerlink" title="3.3 一型一码快连配网"></a>3.3 一型一码快连配网</h4><p>说明：一型一码是指一类家电设备共用同一个二维码，无法具体知道家电设备的<code>deviceSSID</code>是什么，只能确定家电的设备类型，比如空调，类型为<code>0xAC</code></p>
<h5 id="（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和homeSSID一致-1"><a href="#（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和homeSSID一致-1" class="headerlink" title="（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和homeSSID一致"></a>（1）前提：家电设备处于快连模式，手机和待配网的wifi直连，即当前连接的wifi名称应和<code>homeSSID</code>一致</h5><p><img src="https://github.com/midea-sdk-org/ios-sdk/blob/master/pic/wifi.jpg?raw=true" alt=""> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">step 2.3.1 This API can be called if the MSmartConfigType of step 1 is MSmartConfigMSC_OneType. Once this api is called, it will not stop until get a calback or manually stop it.</div><div class="line"></div><div class="line">@since (mainland/overseas)  (group/single user)</div><div class="line">@param deviceType Appliance type. eg:0xAC AC</div><div class="line">@param homeSSID SSID of wifi router</div><div class="line">@param password password of wifi router</div><div class="line">@param tsn tsn from qrcode, can be nil</div><div class="line">@param extension extension,can be nil</div><div class="line">@param key reserve,can be nil</div><div class="line">@param completion Async call</div><div class="line"></div><div class="line">- error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">- dict:the information of appliance</div><div class="line">*/</div><div class="line">- (void)startNewSendMSCWithDeviceType:(NSString *)deviceType</div><div class="line">                           homeSSID:(NSString *)homeSSID</div><div class="line">                           password:(NSString *)password</div><div class="line">                                tsn:(NSString *)tsn</div><div class="line">                          extension:(NSString *)extension</div><div class="line">                                key:(NSString *)key</div><div class="line">                         completion:(void (^)(NSError *err, NSDictionary *dict))completion;</div></pre></td></tr></table></figure>
<h5 id="（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。-1"><a href="#（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。-1" class="headerlink" title="（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。"></a>（2）激活家电。前提：完成配网第一步，收到成功回调，此步骤和AP配网的激活流程类似。</h5><h5 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">NSString *homeSSID = @&quot;APP_TEST&quot;;</div><div class="line">NSString *pwd = @&quot;88888888&quot;;</div><div class="line">NSString *deviceType = @&quot;0xAC&quot;;</div><div class="line">NSString *tsn= @&quot;&quot;;</div><div class="line">[[MSmartDeviceManager sharedManager] startNewSendMSCWithDeviceType:deviceType homeSSID:homeSSID password:pwd tsn:tsn extension:nil key:nil completion:^(NSError *err, NSDictionary *dict) &#123;</div><div class="line">  if(err.code == ERROR_SUCCESS) &#123;</div><div class="line">      //激活家电，参见AP配网激活家电步骤</div><div class="line">  &#125; else &#123;</div><div class="line">      [self printStr:[NSString stringWithFormat:@&quot;配网失败，error：%@&quot;,err]];</div><div class="line">  &#125;</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h3 id="4-获取设备控制权限"><a href="#4-获取设备控制权限" class="headerlink" title="4. 获取设备控制权限"></a>4. 获取设备控制权限</h3><h4 id="4-1-家庭组模式"><a href="#4-1-家庭组模式" class="headerlink" title="4.1 家庭组模式"></a>4.1 家庭组模式</h4><p>​    家庭组模式下，设备是和一个家庭建立的绑定关系，因此获取设备的控制权限，是通过加入设备所在家庭来获取，用户加入一个家庭，可以获取该家庭下所有设备的控制权限</p>
<h5 id="（1）家庭的家长邀请用户加入家庭，用户应答（同意-不同意）"><a href="#（1）家庭的家长邀请用户加入家庭，用户应答（同意-不同意）" class="headerlink" title="（1）家庭的家长邀请用户加入家庭，用户应答（同意/不同意）"></a>（1）家庭的家长邀请用户加入家庭，用户应答（同意/不同意）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 邀请用户加入家庭:家长邀请某个用户加入某个家庭，接口调用成功，会推送一条消息给该用户，若该用户同意则加入家庭成功</div><div class="line"></div><div class="line"> @since (mainland)  (group)</div><div class="line"> @param familyID 家庭Id</div><div class="line"> @param account 邀请成员的邮箱或者手机号</div><div class="line"> @param completion 异步执行返回(block)</div><div class="line"> </div><div class="line">  - error：error.code值为0表示执行成功；大于0表示执行失败；具体错误提示见 MSmartErrorCode 定义或error.localizedDescription</div><div class="line"> */</div><div class="line">- (void) inviteFamilyMemberWithFamilyID:(NSString *)familyID</div><div class="line">                                account:(NSString *)account</div><div class="line">                             completion:(void(^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 邀请用户加入家庭应答：当用户收到邀请的推送后，调用该接口应答是否同意加入，若同意加入则该用户会成为家庭的成员，并且推送消息通知所有家庭成员</div><div class="line"></div><div class="line"> @since (mainland)  (group)</div><div class="line"> @param familyID 家庭ID</div><div class="line"> @param isAccept 是否接受邀请</div><div class="line"> @param completion 异步执行返回(block)</div><div class="line"> </div><div class="line">  - error：error.code值为0表示执行成功；大于0表示执行失败；具体错误提示见 MSmartErrorCode 定义或error.localizedDescription</div><div class="line"> */</div><div class="line">- (void) inviteFamilyMemberResponseWithFamilyID:(NSString *)familyID</div><div class="line">                                       isAccept:(BOOL)isAccept</div><div class="line">                                     completion:(void(^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<h5 id="（2）用户向家庭的家长申请加入家庭，家庭家长应答（同意-不同意）"><a href="#（2）用户向家庭的家长申请加入家庭，家庭家长应答（同意-不同意）" class="headerlink" title="（2）用户向家庭的家长申请加入家庭，家庭家长应答（同意/不同意）"></a>（2）用户向家庭的家长申请加入家庭，家庭家长应答（同意/不同意）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 加入家庭：用户申请加入某个家庭，将接口调用成功，会推送一条消息给该家庭的家长，若该家庭的家长同意则加入家庭成功</div><div class="line"></div><div class="line"> @param familyID 申请加入的家庭Id</div><div class="line"> @param completion 异步执行返回(block)</div><div class="line"> </div><div class="line">  - error：error.code值为0表示执行成功；大于0表示执行失败；具体错误提示见 MSmartErrorCode 定义或error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)joinFamilyWithFamilyID:(NSString *)familyID</div><div class="line">                     completion:(void(^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> 加入家庭应答：当家长收到申请加入的推送后，调用该接口应答是否同意加入，若同意加入则该用户会成为家庭的成员，并且推送消息通知所有家庭成员</div><div class="line"></div><div class="line"> @since (mainland)  (group)</div><div class="line"> @param isAccept 是否同意</div><div class="line"> @param familyID 申请加入的家庭Id</div><div class="line"> @param userID 申请的用户Id</div><div class="line"> @param completion 异步执行返回(block)</div><div class="line"> </div><div class="line">  - error：error.code值为0表示执行成功；大于0表示执行失败；具体错误提示见 MSmartErrorCode 定义或error.localizedDescription</div><div class="line"> */</div><div class="line">- (void) joinFamilyResponseWith:(BOOL)isAccept</div><div class="line">                       familyID:(NSString *)familyID</div><div class="line">                         userID:(NSString *)userID</div><div class="line">                     completion:(void(^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<h4 id="4-2-单用户模式"><a href="#4-2-单用户模式" class="headerlink" title="4.2 单用户模式"></a>4.2 单用户模式</h4><p>​    单用户模式下，设备是和单个用户建立的绑定关系，因此获取设备的控制权限，是通过设备主人对用户提供分享获取。</p>
<h5 id="（1）设备主人主动向用户分享设备，用户应答（同意-不同意）"><a href="#（1）设备主人主动向用户分享设备，用户应答（同意-不同意）" class="headerlink" title="（1）设备主人主动向用户分享设备，用户应答（同意/不同意）"></a>（1）设备主人主动向用户分享设备，用户应答（同意/不同意）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> The Appliance owner share the appliance to another user</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (single user)</div><div class="line"> @param deviceID appliance ID（eg:17591-17592-17593）</div><div class="line"> @param UserId user ID of be shared （eg:1001-1002-1003）</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)shareDeviceWithDeviceID:(NSString *)deviceID</div><div class="line">                       toUserId:(NSString *)UserId</div><div class="line">                     completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Other user reply the appliance sharing from the owner</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (single user)</div><div class="line"> @param deviceID appliance ID（eg:17591）</div><div class="line"> @param account account of the owner</div><div class="line"> @param accept accept or not</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)responseToShareDeviceWithDeviceID:(NSString *)deviceID</div><div class="line">                                  account:(NSString *)account</div><div class="line">                                   accept:(BOOL)accept</div><div class="line">                               completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<h5 id="（2）用户向设备主人申请分享设备，主人应答（同意-不同意）"><a href="#（2）用户向设备主人申请分享设备，主人应答（同意-不同意）" class="headerlink" title="（2）用户向设备主人申请分享设备，主人应答（同意/不同意）"></a>（2）用户向设备主人申请分享设备，主人应答（同意/不同意）</h5><p>##### </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Other users ask the owner share the appliance to them</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (single user)</div><div class="line"> @param deviceId appliance ID</div><div class="line"> @param UserId the user ID of the owner</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)requestDeviceShareWithDeviceId:(NSString *)deviceId</div><div class="line">                             andUserId:(NSString *)UserId</div><div class="line">                            completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> The owner reply the sharing request from other users</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (single user)</div><div class="line"> @param deviceId appliance ID</div><div class="line"> @param UserId request user ID</div><div class="line"> @param accept accept or not</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line"> */</div><div class="line">- (void)requestDeviceShareResponseWithDeviceId:(NSString *)deviceId</div><div class="line">                                     andUserId:(NSString *)UserId</div><div class="line">                                     andAccept:(BOOL)accept</div><div class="line">                                    completion:(void (^)(NSError *error))completion;</div></pre></td></tr></table></figure>
<h3 id="5-推送"><a href="#5-推送" class="headerlink" title="5. 推送"></a>5. 推送</h3><h4 id="5-1-登录时上传pushToken，参见登录接口"><a href="#5-1-登录时上传pushToken，参见登录接口" class="headerlink" title="5.1 登录时上传pushToken，参见登录接口"></a>5.1 登录时上传pushToken，参见登录接口</h4><h5 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#pragma mark - 接收从苹果服务器返回的唯一的设备token</div><div class="line">- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken</div><div class="line">&#123;</div><div class="line">    </div><div class="line">    NSString *DeviceToken = [[deviceToken description] stringByTrimmingCharactersInSet:[NSCharacterSet characterSetWithCharactersInString:@&quot;&lt;&gt;&quot;]] ;</div><div class="line">    NSString *pushToken = [NSString stringWithString:[DeviceToken stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;]];</div><div class="line">    NSLog(@&quot;设备推送:pushToken:%@&quot;, pushToken);</div><div class="line">    [MSPushManager sharedMSPushManager].pushToken = pushToken;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)login &#123;</div><div class="line">       NSMutableDictionary *extraDic = nil;</div><div class="line">       if ([MSPushManager sharedMSPushManager].pushToken) &#123;</div><div class="line">            extraDic = [NSMutableDictionary dictionary];</div><div class="line">            [extraDic setValue:[MSPushManager sharedMSPushManager].pushToken forKey:kMSServerKeyPushToken];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        [self.userMgr loginWithAccount:self.usernameTF.text password:self.passwordTF.text extraDic:extraDic completion:^(NSError *error, NSDictionary *dict, NSArray *familysOrUsers, NSArray *devices) &#123;</div><div class="line"></div><div class="line">        &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="5-2-根据pushId获取推送消息"><a href="#5-2-根据pushId获取推送消息" class="headerlink" title="5.2 根据pushId获取推送消息"></a>5.2 根据pushId获取推送消息</h4><p>​    应用将获取到的pushId调用此接口获取完整的推送信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//MSmartServerManager.h</div><div class="line">  </div><div class="line">/*!</div><div class="line"> *  根据pushId获取推送消息</div><div class="line"> *</div><div class="line"> *  @param pushId     推送获取的pushId</div><div class="line"> *  @param completion  - 异步执行返回(block)</div><div class="line"> *                     - error：error.code值为0表示执行成功；大于0表示执行失败；具体错误提示见MSmartErrorCode定义或error.localizedDescription</div><div class="line"> *                     - content：为推送的内容字典</div><div class="line"> */</div><div class="line">- (void)pushContentGetWithPushId:(NSString *)pushId</div><div class="line">                      completion:(void (^)(NSError *error,NSDictionary *content))completion;</div></pre></td></tr></table></figure>
<p><em>备注：用户重复登录该推送为操作推送，无须通过<code>pushId</code>去获取推送完整信息</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//用户重复登录推送消息示例</div><div class="line">&#123;&quot;pushName&quot;:&quot;user/login&quot;,&quot;userId&quot;:&quot;1000&quot;&#125;</div></pre></td></tr></table></figure>
<h4 id="5-3-处理推送消息"><a href="#5-3-处理推送消息" class="headerlink" title="5.3 处理推送消息"></a>5.3 处理推送消息</h4><p>​    将获取到的完整的推送信息调用此接口，首先返回该信息是否有效，若返回为<code>NO</code>表示该信息无效，若返回为<code>YES</code>表示信息有效并被处理，处理结果通过通知的方式返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//MSmartTransportManager.h</div><div class="line"></div><div class="line">/*!</div><div class="line"> * 处理推送消息</div><div class="line"> *</div><div class="line"> * @param message 收到的美居推送消息</div><div class="line"> * @return true 表示传入的message有效，false表示传入的message无效</div><div class="line"> */</div><div class="line">- (BOOL)handlePushMessage:(NSString *)message;</div></pre></td></tr></table></figure>
<h4 id="5-4-推送消息处理结果的通知PushNotification"><a href="#5-4-推送消息处理结果的通知PushNotification" class="headerlink" title="5.4 推送消息处理结果的通知PushNotification"></a>5.4 推送消息处理结果的通知<code>PushNotification</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[NSNotificationCenter defaultCenter] addObserver:observer selector:@selector(方法名:) name:PushNotification object:nil];</div></pre></td></tr></table></figure>
<p>来监听SDK推送的处理结果。</p>
<p><em>备注：关于<code>PushNotification</code>详细说明请参见<code>MSmartTransportManager.h</code>文件</em></p>
<p><strong>示例</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">//AppDelegate.m</div><div class="line">- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;推送消息%@&quot;,userInfo);</div><div class="line">    if([userInfo[@&quot;pushName&quot;] isEqualToString:@&quot;user/login&quot;]) &#123;//用户重复登录</div><div class="line">        NSLog(@&quot;账号在其他地方登录&quot;);</div><div class="line">    &#125; else &#123;</div><div class="line">        [[MSPushManager sharedMSPushManager] getPushContent:userInfo];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//MSPushManager.m</div><div class="line">- (MSPushManager *)init &#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">      //注册推送通知</div><div class="line">        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(responsePushNotification:) name:PushNotification object:nil];</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)dealloc &#123;</div><div class="line">    //移除通知</div><div class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)getPushContent:(NSDictionary *)dic &#123;</div><div class="line">  //APP收到的服务器端推送的pushID  </div><div class="line">  NSString *pushId = dic[@&quot;pushId&quot;];</div><div class="line">  //根据pushID调用SDK接口获取完整推送信息</div><div class="line">  [[MSmartServerManager sharedManager] pushContentGetWithPushId:pushId completion:^(NSError *error, NSDictionary *content) &#123;</div><div class="line">        if(error.code == ERROR_SUCCESS) &#123;</div><div class="line">            [self pushRemoteToSlkWithDictionary:content[@&quot;result&quot;][@&quot;content&quot;]];</div><div class="line">        &#125;</div><div class="line">    &#125;]; </div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 经过SDK的推送</div><div class="line">- (void)pushRemoteToSlkWithDictionary:(NSString *)pushString &#123;</div><div class="line"></div><div class="line">    NSLog(@&quot;经过sdk的推送:%@&quot;,pushString);</div><div class="line">    NSString *pushContent;</div><div class="line">    if ((pushString.length &lt; 1)||([pushString isEqualToString:@&quot;&quot;])||(pushString == nil))     </div><div class="line">    &#123;</div><div class="line">        return ;</div><div class="line">    &#125; else &#123;</div><div class="line">        //增加SDK识别有效推送信息的前缀</div><div class="line">        pushContent = [NSString stringWithFormat:@&quot;%@%@&quot;,@&quot;&#123;\&quot;message\&quot;:&quot;, pushString];</div><div class="line">    &#125;</div><div class="line">    //处理推送信息</div><div class="line">    BOOL result = [[MSmartTransportManager sharedManager] handlePushMessage:pushContent];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//收到SDK对推送处理通知后所要处理的业务</div><div class="line">- (void)responsePushNotification:(NSNotification *)sender &#123;</div><div class="line">    NSMutableDictionary *pushMessageDic = [NSMutableDictionary dictionaryWithDictionary:sender.object];</div><div class="line">  </div><div class="line">    NSLog(@&quot;PushNotification推送消息推送----&gt;::%@&quot;,pushMessageDic);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6-设备控制"><a href="#6-设备控制" class="headerlink" title="6. 设备控制"></a>6. 设备控制</h3><h4 id="6-1-通过透传指令控制"><a href="#6-1-通过透传指令控制" class="headerlink" title="6.1 通过透传指令控制"></a>6.1 通过透传指令控制</h4><p>​    将设备的控制指令（具体指令内容根据不同品类设备电控协议不同，详细需咨询对应品类事业部）透传，控制结果以通知的形式通知给应用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">//MSmartTransportManager.h</div><div class="line">/**</div><div class="line"> Send data to appliance</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @param deviceID appliance ID</div><div class="line"> @param tempArray data</div><div class="line"> @param tag the tag of the send</div><div class="line"> */</div><div class="line">- (void)sendDataWithDeviceID:(NSString *)deviceID</div><div class="line">                    tempArray:(NSArray *)tempArray</div><div class="line">                          tag:(int)tag;</div><div class="line"></div><div class="line">/*#</div><div class="line"> *   Transport result notice</div><div class="line"> *   Use [[NSNotificationCenter defaultCenter] addObserver:observer selector:@selector(yourSelector:) name:TransportNotification object:nil];</div><div class="line"> *   the class of object of NSNotification is NSDictionary.</div><div class="line"> *</div><div class="line"> *</div><div class="line"> *                      dic&#123;</div><div class="line"> *                      key:@&quot;deviceId&quot;     type:NSString   appliance ID</div><div class="line"> *                      key:@&quot;tag&quot;          type:NSNumber   command tag</div><div class="line"> *                      key:@&quot;cmdArray&quot;     type:NSArray    decimal command array</div><div class="line"> *                      key:@&quot;hexCmdArray&quot;  type:NSArray    hexadecimal command array</div><div class="line"> *                      key:@&quot;error&quot;        type:NSError    error message</div><div class="line"> *</div><div class="line"> *</div><div class="line"> **/</div><div class="line">static NSString *const TransportNotification  = @&quot;MSTransportNotification&quot;;</div></pre></td></tr></table></figure>
<h5 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">    [super viewWillAppear:NO];</div><div class="line">    [self configNotification];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewWillDisappear:(BOOL)animated &#123;</div><div class="line">    [super viewWillDisappear:NO];</div><div class="line">    [self removeNotification];</div><div class="line">&#125;</div><div class="line">// 发送指令</div><div class="line">- (IBAction)sendCMD:(id)sender &#123;</div><div class="line">    </div><div class="line">    //诸如指令内容是0xaa14e20032,</div><div class="line">    NSString *cmdString = @&quot;aa14e20032&quot;;</div><div class="line">    NSArray *cmdArray = [self stringToArry:cmdString]//@[@&quot;aa&quot;,@&quot;14&quot;,@&quot;e2&quot;,@&quot;00&quot;,@&quot;32&quot;];</div><div class="line">    self.tag = arc4random() % UINT16_MAX;</div><div class="line">    [self.transportMgr sendDataWithDeviceID:self.iDevice.deviceId</div><div class="line">                                  tempArray:cmdArray</div><div class="line">                                        tag:self.tag];</div><div class="line">    [MSTools showHudWithStr:@&quot;发送指令中...&quot; inView:self.navigationController.view];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - 透传回调</div><div class="line">- (void)responseAfterSend:(NSNotification *)note &#123;</div><div class="line">    </div><div class="line">    NSDictionary *dict = (NSDictionary *)note.object;</div><div class="line">    NSError *error = dict[ @&quot;error&quot; ];</div><div class="line">    NSString *tagStr = dict[@&quot;tag&quot;];</div><div class="line">    int tagId = [tagStr intValue];</div><div class="line">    NSString *deviceId = dict[@&quot;deviceId&quot;];</div><div class="line">    </div><div class="line">    if((tagId == self.tag) &amp;&amp; ([deviceId isEqualToString:self.iDevice.deviceId])) &#123;</div><div class="line">        if(error.code == 0) &#123;</div><div class="line">            [MSTools showAlert:@&quot;执行成功&quot;];</div><div class="line">        &#125; else &#123;</div><div class="line">            [MSTools showAlert:@&quot;执行失败&quot;];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)configNotification &#123;</div><div class="line">    //设置监听</div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(responseAfterSend:) name:TransportNotification object:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)removeNotification &#123;</div><div class="line">    //移除监听</div><div class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self name:TransportNotification object:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - string转化为array</div><div class="line">- (NSArray *)stringToArry:(NSString *)str &#123;</div><div class="line">    NSMutableArray *array = [[NSMutableArray alloc]init];</div><div class="line">    int length = (int)[str length];</div><div class="line">    for (int i = 0;i &lt; length/2;i++) &#123;</div><div class="line">        NSString *sub_str = [[NSString alloc]initWithString:[str substringWithRange:NSMakeRange(i*2, 2)]];</div><div class="line">        [array addObject:sub_str];</div><div class="line">    &#125;</div><div class="line">    return array;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="6-2-通过lua脚本控制"><a href="#6-2-通过lua脚本控制" class="headerlink" title="6.2 通过lua脚本控制"></a>6.2 通过lua脚本控制</h4><h5 id="（1）将开放平台上下载的控制协议脚本放在以lua命名的文件夹中，如图所示。"><a href="#（1）将开放平台上下载的控制协议脚本放在以lua命名的文件夹中，如图所示。" class="headerlink" title="（1）将开放平台上下载的控制协议脚本放在以lua命名的文件夹中，如图所示。"></a>（1）将开放平台上下载的控制协议脚本放在以<code>lua</code>命名的文件夹中，如图所示。</h5><p><img src="https://github.com/midea-sdk-org/ios-sdk/blob/master/pic/lua%E6%96%87%E4%BB%B6%E5%A4%B9%E7%A4%BA%E4%BE%8B.png?raw=true" alt=""> </p>
<p><em>备注：脚本文件与申请的<code>appId</code>以及<code>appKey</code>关联，必须使用对应脚本文件</em></p>
<p><strong>（2）在项目工程<code>Copy Bundle Resources</code> 中添加上述的<code>lua</code>文件夹，如图所示。</strong></p>
<p><img src="https://github.com/midea-sdk-org/ios-sdk/blob/master/pic/%E5%AF%BC%E5%85%A5lua%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B.png?raw=true" alt=""> </p>
<h5 id="（3）调用SDK接口"><a href="#（3）调用SDK接口" class="headerlink" title="（3）调用SDK接口"></a>（3）调用SDK接口</h5><ul>
<li>根据<code>deviceId</code>查询设备当前状态</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Query appliance status</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @param deviceId appliance ID</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">  - dict:appliance current status</div><div class="line"> */</div><div class="line">- (void)queryDeviceWithId:(NSString *)deviceId</div><div class="line">               completion:(void (^)(NSError *error, NSDictionary *dict))completion;</div></pre></td></tr></table></figure>
<h5 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[[MSmartDeviceManager sharedManager] queryDeviceWithId:self.currentDevice.deviceId </div><div class="line">       completion:^(NSError *error, NSDictionary *dict) &#123;</div><div class="line">        if (error.code == 0) &#123;</div><div class="line">            NSLog(@&quot;dict is \n%@&quot;,dict);</div><div class="line">        &#125;</div><div class="line">        else &#123;</div><div class="line">            NSLog(@&quot;error.code is %@&quot;,error.localizedDescription);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>执行结果：</p>
<p><img src="https://github.com/midea-sdk-org/ios-sdk/blob/master/pic/%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%AD%97%E5%85%B8.jpeg?raw=true" alt=""></p>
<p><em>备注：<code>dict</code>中key-value表示设备的属性及属性当前的值，具体参考设备属性文档</em></p>
<ul>
<li>根据<code>deviceId</code>和控制意图字典控制设备</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> Appliance status control</div><div class="line"></div><div class="line"> @since (mainland/overseas)  (group/single user)</div><div class="line"> @param deviceId appliance ID</div><div class="line"> @param operationDic control information dictionary</div><div class="line"> @param completion Async call</div><div class="line"> </div><div class="line">  - error.code contains: 0 succeed &gt;0 failed, detailed definition in MSmartErrorCode or error.localizedDescription</div><div class="line">  - dict:appliance new status</div><div class="line"> */</div><div class="line">- (void)controlDeviceWithId:(NSString *)deviceId</div><div class="line">               operationDic:(NSDictionary *)operationDic</div><div class="line">                 completion:(void (^)(NSError *error, NSDictionary *dict))completion;</div></pre></td></tr></table></figure>
<h5 id="示例：控制（空调电源打开、模式设为制热模式、温度设为28度、左右扫风打开、上下扫风打开）"><a href="#示例：控制（空调电源打开、模式设为制热模式、温度设为28度、左右扫风打开、上下扫风打开）" class="headerlink" title="示例：控制（空调电源打开、模式设为制热模式、温度设为28度、左右扫风打开、上下扫风打开）"></a>示例：控制（空调电源打开、模式设为制热模式、温度设为28度、左右扫风打开、上下扫风打开）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">NSDictionary *controlDic = @&#123;@&quot;power&quot;:@&quot;on&quot;,</div><div class="line">                             @&quot;mode&quot;:@&quot;heat&quot;,</div><div class="line">                             @&quot;temperature&quot;:@(28),</div><div class="line">                             @&quot;wind_swing_lr&quot;:@&quot;on&quot;,</div><div class="line">                             @&quot;wind_swing_ud&quot;:@&quot;on&quot;</div><div class="line">                                 &#125;;</div><div class="line">[[MSmartDeviceManager sharedManager] controlDeviceWithId:self.currentDevice.deviceId </div><div class="line">                         operationDic:controlDic </div><div class="line">                           completion:^(NSError *error, NSDictionary *dict) &#123;</div><div class="line">        if (error.code == 0) &#123;</div><div class="line">            NSLog(@&quot;dict is \n%@&quot;,dict);</div><div class="line">        &#125;</div><div class="line">        else &#123;</div><div class="line">            NSLog(@&quot;error.code is %@&quot;,error.localizedDescription);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<p>执行结果：</p>
<p><img src="https://github.com/midea-sdk-org/ios-sdk/blob/master/pic/%E6%8E%A7%E5%88%B6%E8%BF%94%E5%9B%9E%E5%AD%97%E5%85%B8.jpeg?raw=true" alt="">                 </p>
<p><em>备注：<code>operationDic</code>以及<code>dict</code>中key-value表示设备的属性及属性的值，具体参考设备属性文档</em></p>
<h2 id="技术支持"><a href="#技术支持" class="headerlink" title="技术支持"></a>技术支持</h2><p>王攀(pan.wang@midea.com)</p>
<p><a href="https://github.com/midea-sdk-org/ios-sdk/issues/new" target="_blank" rel="external">Issues</a></p>
<h2 id="API文档"><a href="#API文档" class="headerlink" title="API文档"></a>API文档</h2><p><a href="http://htmlpreview.github.io/?https://github.com/midea-sdk-org/ios-sdk/blob/master/html/index.html" target="_blank" rel="external">接口文档</a> </p>
<p><a href="https://github.com/midea-sdk-org/ios-sdk/blob/master/ChangeLog.md" target="_blank" rel="external">改动日志</a>   </p>
<h2 id="SDK下载"><a href="#SDK下载" class="headerlink" title="SDK下载"></a>SDK下载</h2><p><a href="https://github.com/midea-sdk-org/ios-sdk/releases" target="_blank" rel="external">下载地址</a> </p>
</div></article></div></main><footer><div class="paginator"><a href="../mideasdk3.0更新日志/" class="prev">上一篇</a><a href="../../../09/13/midea-sdk-lan-scan/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2017 <a href="">Midea Smart Technology Co.,Ltd.</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>